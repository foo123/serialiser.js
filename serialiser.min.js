/**
*  Serialiser.js
*  Parse, serialise and url-encode/decode complex form fields to/from an object model / FormData
*
*  @version: 0.5.0
*  https://github.com/foo123/serialiser.js
*
**/
!function(e,t,n){"use strict";"object"==typeof exports?module.exports=n():"function"==typeof define&&define.amd?define(function(){return n()}):e[t]=n()}(this,"Serialiser",function(e){"use strict";function t(e,t){if("function"==typeof e)return e;if(t){var n=J("^"+V(t)+"([\\.\\[].+)$");return function(t){var r,o=t[m](e);return o&&(r=o.match(n))?r[1]:null}}return function(t){return t[m](e)}}function r(t,n){return"function"==typeof t?t:!1!==n?function(n){var r=("value"===t?P(n):n[m](t))||"",o=(n[m]("type")||n[x]||"").toLowerCase();return"file"===o?n.files.length?n.files[0]||null:e:("checkbox"!==o&&"radio"!==o||n[w])&&("select"!==o||r.length&&-1!==n[M])&&("text"!==o&&"textarea"!==o||X(r).length)?r:e}:function(n){var r=("value"===t?P(n):n[m](t))||"",o=(n[m]("type")||n[x]).toLowerCase();return"file"===o?n.files.length?n.files[0]||null:e:"checkbox"!==o&&"radio"!==o||n[w]?r:e}}function o(e,n,o,i,u,a){n=n||{},o=t(o||"name"),i=r(i||"value"),arguments.length<5&&(u=!1),a=!0===a;for(var f=0,c=e.length;c>f;f++){var l,s,d,h,p,g,v=e[f],y=!1,C=u?!!v[m](u):!1;if(l=o(v),l&&(s=i(v),null!=s)){C&&(s=s?I(s):null);var y=W.test(l);for(d=q(l).split("."),p=n;d.length;)h=d.shift(),d.length?(p[A](h)?!a&&K.test(d[0])&&p[h].length<=(g=parseInt(d[0],10))&&(p[h]=p[h].concat(new Array(g-p[h].length+1))):p[h]=y&&1===d.length?[]:!a&&K.test(d[0])?new Array(parseInt(d[0],10)+1):{},p=p[h]):y?p.push(s):p[h]=s}}return n}function u(e,t){var n,r,o,i,u,a,f,c;for("data:"===e.substr(0,5)?(-1<(c=dataUri.indexOf(";base64,"))?(o=dataUri.slice(5,c),dataUri=dataUri.slice(c+8),n=S(dataUri)):(o=dataUri.slice(5,c=dataUri.indexOf(",")),dataUri=dataUri.slice(c+1),n=unescape(e)),null==t&&(t=o)):n=e,a=n.length,r=new Uint8Array(a),u=15&a,i=0;u>i;i++)r[i]=255&n.charCodeAt(i);for(i=u;a>i;i+=16)f=i,r[f]=255&n.charCodeAt(f++),r[f]=255&n.charCodeAt(f++),r[f]=255&n.charCodeAt(f++),r[f]=255&n.charCodeAt(f++),r[f]=255&n.charCodeAt(f++),r[f]=255&n.charCodeAt(f++),r[f]=255&n.charCodeAt(f++),r[f]=255&n.charCodeAt(f++),r[f]=255&n.charCodeAt(f++),r[f]=255&n.charCodeAt(f++),r[f]=255&n.charCodeAt(f++),r[f]=255&n.charCodeAt(f++),r[f]=255&n.charCodeAt(f++),r[f]=255&n.charCodeAt(f++),r[f]=255&n.charCodeAt(f++),r[f]=255&n.charCodeAt(f++);return new Blob([r],{type:t})}function a(e,t,r,o){t=t||{},r=!!r,o=!0===o;var u,a,f,c,s,d,h={"true":!0,"false":!1,"null":null,undefined:void 0};for(u=e.replace(/%20|\+/g," ").split("&"),i=0,l=u.length;l>i;i++){a=u[i].split("="),f=j(a[0]),c=a.length>1?j(a[1]):r?void 0:"",r&&(c=c&&!isNaN(c)&&+c+""===c?+c:"undefined"==typeof c?void 0:h[A][c]?h[c]:c);var p=W.test(f);for(f=q(f).split("."),s=t;f.length;)d=f.shift(),f.length?(s[A](d)?!o&&K.test(f[0])&&s[d].length<=(n=parseInt(f[0],10))&&(s[d]=s[d].concat(new Array(n-s[d].length+1))):s[d]=p&&1===f.length?[]:!o&&K.test(f[0])?new Array(parseInt(f[0],10)+1):{},s=s[d]):p?s.push(c):s[d]=c}return t}function f(e,t,n){"function"==typeof n&&(n=n()),e.push(T(t)+"="+T(null==n?"":n))}function c(e,t,n){var r,o,i;if(n)if(z(t))if(W.test(n))for(o=0,i=t.length;i>o;o++)f(e,n,t[o]);else for(o=0,i=t.length;i>o;o++)c(e,t[o],n+"["+("object"==typeof t[o]?o:"")+"]");else if(t&&"object"==typeof t)for(r in t)t[A](r)&&c(e,t[r],n+"["+r+"]");else f(e,n,t);else if(z(t))for(o=0,i=t.length;i>o;o++)f(e,t[o].name,t[o].value);else if(t&&"object"==typeof t)for(r in t)t[A](r)&&c(e,t[r],n);return e}function s(e,t,n){var r=c(t||[],e||{});return!0!==n&&(r=r.join("&").split("%20").join("+")),r}function d(e,t,n){"function"==typeof n&&(n=n()),e.append(t,null==n?"":n)}function h(e,t,n){var r,o,i;if(n)if(z(t))if(W.test(n))for(o=0,i=t.length;i>o;o++)d(e,n,t[o]);else for(o=0,i=t.length;i>o;o++)h(e,t[o],n+"["+("object"==typeof t[o]?o:"")+"]");else if(t&&"object"==typeof t)for(r in t)t[A](r)&&h(e,t[r],n+"["+r+"]");else d(e,n,t);else if(z(t))for(o=0,i=t.length;i>o;o++)d(e,t[o].name,t[o].value);else if(t&&"object"==typeof t)for(r in t)t[A](r)&&h(e,t[r],n);return e}function p(e,t){return h(t||new FormData,e||{})}function g(e){return b(e||{})}function v(){return!0}function y(){return!1}var A="hasOwnProperty",C=Object.prototype.toString,b=JSON.stringify,I=JSON.parse,S=atob,T=encodeURIComponent,j=decodeURIComponent,m="getAttribute",w="checked",U="disabled",E="selected",x="tagName",O="type",N="value",L="options",M="selectedIndex",F="parentNode",R="innerText",$="textContent",D=function(e){var t=e.attributes[N];return!t||t.specified?e[N]:e.text},k=function(e){for(var t,n,r=e[L],o=e[M],i="select-one"===e[O]||0>o,u=i?null:[],a=i?o+1:r.length,f=0>o?a:i?o:0;a>f;f++)if(n=r[f],!(!n[E]&&f!==o||n[U]||n[F][U]&&"optgroup"===n[F][x].toLowerCase())){if(t=D(n),i)return t;u.push(t)}return u},P=function(e){if(e)switch(e[x].toLowerCase()){case"textarea":case"input":return e[N];case"select":return k(e);default:return $ in e?e[$]:e[R]}},B=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,V=function(e){return e.replace(B,"\\$&")},J=function(e,t){return new RegExp(e,t||"")},H=/^\s+|\s+$/g,X=String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(H,"")},K=/^\d+$/,Q=/\[([^\]]*)\]/g,W=/\[\s*\]$/,_=/^\.+/g,q=function(e){return e.replace(Q,".$1").replace(_,"")},z=function(e){return"[object Array]"===C.call(e)};return{VERSION:"0.5.0",Type:{COMPOSITE:function(){var e=arguments;return e[0]&&e[0].concat&&(e=e[0]),function(t,n,r,o,i){for(var u=e.length;u--;)t=e[u](t,n,r,o,i);return t}},DEFAULT:function(e){return function(t){return(null==t||"[object String]"===C.call(t)&&!X(t).length)&&(t=e),t}},BOOL:function(e){if("[object String]"===C.call(e)&&e.length){var t=e.toLowerCase();return"true"===t||"on"===t||"yes"===t||"1"===t}return!!e},INT:function(e){return parseInt(e||0,10)||0},FLOAT:function(e){return parseFloat(e||0,10)||0},STR:function(e){return String(e)},MIN:function(e){return function(t){return e>t?e:t}},MAX:function(e){return function(t){return t>e?e:t}},CLAMP:function(e,t){if(e>t){var n=t;t=e,e=n}return function(n){return e>n?e:n>t?t:n}}},Validator:{PASS:v,FAIL:y,NOT:function(e){return function(t,n,r,o,i){return!e(t,n,r,o,i)}},AND:function(e,t){return function(n,r,o,i,u){return e(n,r,o,i,u)&&t(n,r,o,i,u)}},EITHER:function(e,t){return function(n,r,o,i,u){return e(n,r,o,i,u)||t(n,r,o,i,u)}},IIF:function(e,t,n){return n=n||v,function(r,o,i,u,a){return e(r,o,i,u,a)?t(r,o,i,u,a):n(r,o,i,u,a)}},REQUIRED:function(e){var t=C.call(e);return"[object String]"==t||"[object Array]"==t?!!e.length:null!=e},IS:function(e,t,n){return!0===n?function(n,r,o){return t===o[e]}:function(n,r,o){return t==o[e]}},BETWEEN:function(e,t,n){if(e>t){var r=e;e=t,t=r}return!0===n?function(n){return n>e&&t>n}:function(n){return n>=e&&t>=n}},MATCHES:function(e){return function(t){return e.test(t)}},EXPRESSION:function(e){return new Function("value,key,model,index,model_key","return ("+e+");")}},Typecast:function(e,t){if(t)for(var n in t)if(t[A](n)){var r=t[n];if("[object Array]"===C.call(r)){if(e[A](n)){var o,i=e[n],u=i.length,r=r[0];for(o=0;u>o;o++)i[o]=r(i[o],n,e,o,i)}}else e[n]=r(e[n],n,e)}return e},Validate:function(e,t,n,r){var o=!0;if(r=r||"",t)for(var i in t)if(t[A](i)){var u=t[i];if("[object Array]"===C.call(u[0]))if(e[A](i)){var a,f=u[0][0],c=e[i],l=c.length,s=new Array(l),d=!1,h=u[1];for(a=0;l>a;a++)f(c[a],i,e,a,c)||(s[a]=h,d=!0);d&&(n[r+i]=s,o=!1)}else o=!1;else u[0](e[i],i,e)||(n[r+i]=u[1],o=!1)}return o},Key:t,Value:r,DataUriToBlob:u,FieldsToModel:o,UrlEncodedToModel:a,ModelToJSON:g,ModelToFormData:p,ModelToUrlEncoded:s}});